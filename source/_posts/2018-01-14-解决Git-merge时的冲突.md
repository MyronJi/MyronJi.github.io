---
title: 解决Git merge时的冲突
date: 2018-01-14 18:23:43
tags: Git
categories: Tool
---
merge代码时遇到的冲突，记录一下解决的方法。
<!--more-->
{% note info %}
执行`git pull` 的时候实际上是先执行 `git fetch` 获取远程仓库的数据，再执行`git merge`将其与本地的当前分支合并。
{% endnote %}
# 背景
merge有冲突时，原本显示分支的地方会多出`MERGING`提示，我们需要在这个分支中解决冲突。
![](\2018/01/14/解决Git-merge时的冲突\merge0.png)
{% note info %}
没有冲突的部分会自动合并
{% endnote %}

# 两种情况会导致merge失败
1. 同一个文件中既有2个人独自编辑的部分也有共同编辑的部分，merge时共同编辑的部分git不知道要保留谁的，这就导致了冲突，merge失败。
![](\2018/01/14/解决Git-merge时的冲突\merge1.png)
2. 还有一种情况是服务器上最新的版本中某个文件被删除了，但是本地版本中还有此文件，这也会导致merge失败。
![](\2018/01/14/解决Git-merge时的冲突\merge2.png)

# 第一种情况的解决方法
我们可以通过`git checkout`+ `--ours` / `--theirs`来告诉git我们要保留本地版本还是服务器版本的文件
## 保留本地版本的文件
`git checkout --ours`ours表示dev分支的版本 
![](\2018/01/14/解决Git-merge时的冲突\merge3.png)
## 保留服务器版本的文件
`git checkout --theirs` theris表示服务器上的版本
![](\2018/01/14/解决Git-merge时的冲突\merge4.png)
## 批量保留服务器版本的文件
符号`.`在git中表示所有文件，我们可以用`git checkout --theirs .` 来批量保留服务器版本的文件。
![](\2018/01/14/解决Git-merge时的冲突\merge5.png)
{% note danger %}
批量checkout时要确保冲突文件中没有delete by them的文件，否则会报错：
![](\2018/01/14/解决Git-merge时的冲突\merge5.png)
{% endnote %}

# 第二种情况的解决方法
## 删除本地文件
使用`git rm`来删除本地文件。
![](\2018/01/14/解决Git-merge时的冲突\rm1.png)
使用`git status`来看一下状态，发现刚刚删除的TX1686.xml已经不见了。
![](\2018/01/14/解决Git-merge时的冲突\rm2.png)

## 保留本地文件
如果要保留本地文件则可以用`git checkout --ours`来保留
![](\2018/01/14/解决Git-merge时的冲突\rm3.png)

# 提交更改
所有冲突都解决完之后就需要`git commit -am 'comments'`来保存更改。提交后分支名旁边的`MERGING`就会消失了，此时代码就成功合并了。